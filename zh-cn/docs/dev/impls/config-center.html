<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="config-center" />
	<meta name="description" content="config-center" />
	<!-- 网页标签标题 -->
	<title>config-center</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/index.html">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a target="_self" href="/zh-cn/docs/user/quick-start.html">文档</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/docs/developers/developers_dev.html">开发者</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/blog/download.html">下载</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>文档</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/preface/background.html" target="_self">背景</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>Dubbo配置中心</h1>
<h2>设计目的</h2>
<p>配置中心的核心功能是作为Key-Value存储，Dubbo框架告知配置中心其关心的key，配置中心返回该key对应的value值。</p>
<p>按照应用场景划分，配置中心在Dubbo框架中主要承担以下职责：</p>
<ul>
<li>作为外部化配置中心，即存储dubbo.properties配置文件，此时，key值通常为文件名如dubbo.properties，value则为配置文件内容。</li>
<li>存储单个配置项，如各种开关项、常量值等。</li>
<li>存储服务治理规则，此时key通常按照&quot;服务名+规则类型&quot;的格式来组织，而value则为具体的治理规则。</li>
</ul>
<p>为了进一步实现对key-value的分组管理，Dubbo的配置中心还加入了namespace、group的概念，这些概念在很多专业的第三方配置中心中都有体现，通常情况下，namespace用来隔离不同的租户，group用来对同一租户的key集合做分组。</p>
<p>当前，Dubbo配置中心实现了对Zookeeper、Nacos、Etcd、Consul、Apollo的对接，接下来我们具体看一下Dubbo抽象的配置中心是怎么映射到具体的第三方实现中的。</p>
<h2>扩展接口</h2>
<ul>
<li><code>org.apache.dubbo.configcenter.DynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.configcenter.DynamicConfiguration</code></li>
</ul>
<h2>已知扩展</h2>
<ul>
<li><code>org.apache.dubbo.configcenter.support.zookeeper.ZookeeperDynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.configcenter.support.nacos.NacosDynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.configcenter.support.etcd.EtcdDynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.configcenter.consul.ConsulDynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.configcenter.support.apollo.ApolloDynamicConfigurationFactory</code></li>
<li><code>org.apache.dubbo.common.config.configcenter.file.FileSystemDynamicConfigurationFactory</code></li>
</ul>
<h2>实现原理</h2>
<h3>Zookeeper</h3>
<p>zookeeper提供了一个树状的存储模型，其实现原理如下：</p>
<p><img src="/img/configcenter_zk_model.jpg" alt="image-20190127225608553"></p>
<p>namespace, group, key等分别对应不同层级的ZNode节点，而value则作为根ZNode节点的值存储。</p>
<ol>
<li>
<p>外部化配置中心 dubbo.properties</p>
<p><img src="/img/configcenter_zk_properties.jpg" alt="image-20190127225608553"></p>
<p>上图展示了两个不同作用域的dubbo.properties文件在zookeeper中的存储结构：</p>
<ul>
<li>命名空间namespace都为：dubbo</li>
<li>分组group：全局级别为dubbo，所有应用共享；应用级别为应用名demo-provider，只对该应用生效</li>
<li>key：dubbo.properties</li>
</ul>
</li>
<li>
<p>单个配置项</p>
<p><img src="/img/configcenter_zk_singleitem.jpg" alt="image-20190127225608553"></p>
<p>设置优雅停机事件为15000：</p>
<ul>
<li>命名空间namespace：dubbo</li>
<li>分组group：dubbo</li>
<li>key：dubbo.service.shutdown.wait</li>
<li>value：15000</li>
</ul>
</li>
<li>
<p>服务治理规则</p>
<p><img src="/img/configcenter_zk_rule.jpg" alt="image-20190127225608553"></p>
<p>上图展示了一条应用级别的条件路由规则：</p>
<ul>
<li>命名空间namespace：dubbo</li>
<li>分组group：dubbo</li>
<li>key：governance-conditionrouter-consumer.condition-router，其中governance-conditionrouter-consumer为应用名，condition-router代表条件路由</li>
</ul>
<blockquote>
<p>注意:</p>
<p>Dubbo同时支持应用、服务两种粒度的服务治理规则，对于这两种粒度，其key取值规则如下：</p>
<ul>
<li>应用粒度 {应用名 + 规则后缀}。如: <code>demo-application.configurators</code>、<code>demo-application.tag-router</code>等</li>
<li>服务粒度 {服务接口名:[服务版本]:[服务分组] + 规则后缀}，其中服务版本、服务分组是可选的，如果它们有配置则在key中体现，没被配置则用&quot;:&quot;占位。如
<code>org.apache.dubbo.demo.DemoService::.configurators</code>、<code>org.apache.dubbo.demo.DemoService:1.0.0:group1.configurators</code></li>
</ul>
</blockquote>
</li>
</ol>
<h3>Etcd &amp; Consul</h3>
<p>Etcd和Consul本质上也是一种类似zookeeper的树状存储结构，实现请参考zookeeper。</p>
<h3>Nacos</h3>
<p>Nacos作为一个专业的第三方配置中心，拥有专门为配置中心设计的存储结构，包括内置的namespace、group、dataid等概念。并且这几个概念基本上与Dubbo框架抽象的配置中心是一一对应的。</p>
<p>与Zookeeper实现的对应关系如下：</p>
<p><img src="/img/configcenter_nacos_model.jpg" alt="image-20190127225608553"></p>
<p>参考上文关于zookeeper实现中描述的示例，这里的dataid可能为：</p>
<ul>
<li>外部化配置中心：dubbo.properties</li>
<li>单个配置项：dubbo.service.shutdown.wait</li>
<li>服务治理规则：org.apache.dubbo.demo.DemoService:1.0.0:group1.configurators</li>
</ul>
<h3>Apollo</h3>
<p>Apollo与Nacos类似，请参考动态配置中心使用文档中关于Apollo部分的描述。</p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/dev/build.html" target="_self">开发者指南</a></dd><dd><a href="/zh-cn/docs/admin/ops/dubbo-ops.html" target="_self">运维管理</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">编辑此文档</a></dd></dl></div></div><div class="copyright"><span>TODO Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>