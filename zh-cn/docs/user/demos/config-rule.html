<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="config-rule" />
	<meta name="description" content="config-rule" />
	<!-- 网页标签标题 -->
	<title>config-rule</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/index.html">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a target="_self" href="/zh-cn/docs/user/quick-start.html">文档</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/docs/developers/developers_dev.html">开发者</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/blog/download.html">下载</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>文档</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/preface/background.html" target="_self">背景</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>配置规则</h1>
<p>查看<a href="./config-rule-deprecated.md">老版本配置规则</a>。</p>
<p>覆盖规则是Dubbo设计的在无需重启应用的情况下，动态调整RPC调用行为的一种能力。2.7.0版本开始，支持从<strong>服务</strong>和<strong>应用</strong>两个粒度来调整动态配置。</p>
<h2>概览</h2>
<p>请在<a href="http://47.91.207.147/#/governance/config">服务治理控制台</a>查看或修改覆盖规则。</p>
<ul>
<li>
<p>应用粒度</p>
<pre><code class="language-yaml"><span class="hljs-comment"># 将应用demo（key:demo）在20880端口上提供（side:provider）的所有服务（scope:application）的权重修改为1000（weight:1000）。</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">application</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">demo</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">["0.0.0.0:20880"]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">provider</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">weight:</span> <span class="hljs-number">1000</span>
<span class="hljs-string">...</span>
</code></pre>
</li>
<li>
<p>服务粒度</p>
<pre><code class="language-yaml"><span class="hljs-comment"># 所有消费（side:consumer）DemoService服务（key:org.apache.dubbo.samples.governance.api.DemoService）的应用实例（addresses:[0.0.0.0]），超时时间修改为6000ms</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">service</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">org.apache.dubbo.samples.governance.api.DemoService</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">[0.0.0.0]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">consumer</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-number">6000</span>
<span class="hljs-string">...</span>

</code></pre>
</li>
</ul>
<h2>规则详解</h2>
<h4>配置模板</h4>
<pre><code class="language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">application/service</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">app-name/group+service+version</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">["0.0.0.0"]</span>
  <span class="hljs-attr">providerAddresses:</span> <span class="hljs-string">["1.1.1.1:20880",</span> <span class="hljs-string">"2.2.2.2:20881"</span><span class="hljs-string">]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">consumer</span>
  <span class="hljs-attr">applications/services:</span> <span class="hljs-string">[]</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-number">1000</span>
    <span class="hljs-attr">cluster:</span> <span class="hljs-string">failfase</span>
    <span class="hljs-attr">loadbalance:</span> <span class="hljs-string">random</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">["0.0.0.0:20880"]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">provider</span>
  <span class="hljs-attr">applications/services:</span> <span class="hljs-string">[]</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">threadpool:</span> <span class="hljs-string">fixed</span>
    <span class="hljs-attr">threads:</span> <span class="hljs-number">200</span>
    <span class="hljs-attr">iothreads:</span> <span class="hljs-number">4</span>
    <span class="hljs-attr">dispatcher:</span> <span class="hljs-string">all</span>
    <span class="hljs-attr">weight:</span> <span class="hljs-number">200</span>
<span class="hljs-string">...</span>
</code></pre>
<p>其中：</p>
<ul>
<li><code>configVersion</code>表示dubbo的版本</li>
<li><code>scope</code>表示配置作用范围，分别是应用（application）或服务（service）粒度。<strong>必填</strong>。</li>
<li><code>key</code> 指定规则体作用在哪个服务或应用。<strong>必填</strong>。
<ul>
<li>scope=service时，key取值为[{group}:]{service}[:{version}]的组合</li>
</ul>
</li>
<li>scope=application时，key取值为application名称</li>
<li><code>enabled=true</code> 覆盖规则是否生效，可不填，缺省生效。</li>
<li><code>configs</code> 定义具体的覆盖规则内容，可以指定n（n&gt;=1）个规则体。<strong>必填</strong>。
<ul>
<li>side，</li>
<li>applications</li>
<li>services</li>
<li>parameters</li>
<li>addresses</li>
<li>providerAddresses</li>
</ul>
</li>
</ul>
<br/>
**对于绝大多数配置场景，只需要理清楚以下问题基本就知道配置该怎么写了：**
<ol>
<li>
<p>要修改整个应用的配置还是某个服务的配置。</p>
<ul>
<li>应用：<code>scope: application, key: app-name</code>（还可使用<code>services</code>指定某几个服务）。</li>
<li>服务：<code>scope: service, key:group+service+version</code>。</li>
</ul>
</li>
<li>
<p>修改是作用到消费者端还是提供者端。</p>
<ul>
<li>消费者：<code>side: consumer</code> ，作用到消费端时（你还可以进一步使用<code>providerAddress</code>, <code>applications</code>选定特定的提供者示例或应用）。</li>
<li>提供者：<code>side: provider</code>。</li>
</ul>
</li>
<li>
<p>配置是否只对某几个特定实例生效。</p>
<ul>
<li>所有实例：<code>addresses: [&quot;0.0.0.0&quot;]</code>或<code>addresses: [&quot;0.0.0.0:*&quot;]</code>具体由side值决定。</li>
<li>指定实例：<code>addersses[实例地址列表]</code>。</li>
</ul>
</li>
<li>
<p>要修改的属性是哪个。</p>
</li>
</ol>
<h4>示例</h4>
<ol>
<li>
<p>禁用提供者：(通常用于临时踢除某台提供者机器，相似的，禁止消费者访问请使用路由规则)</p>
<pre><code class="language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">application</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">demo-provider</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">["10.20.153.10:20880"]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">provider</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">disabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">...</span>
</code></pre>
</li>
<li>
<p>调整权重：(通常用于容量评估，缺省权重为 200)</p>
<pre><code class="language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">application</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">demo-provider</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">addresses:</span> <span class="hljs-string">["10.20.153.10:20880"]</span>
  <span class="hljs-attr">side:</span> <span class="hljs-string">provider</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">weight:</span> <span class="hljs-number">200</span>
<span class="hljs-string">...</span>
</code></pre>
</li>
<li>
<p>调整负载均衡策略：(缺省负载均衡策略为 random)</p>
<pre><code class="language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">application</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">demo-consumer</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">side:</span> <span class="hljs-string">consumer</span>
  <span class="hljs-attr">parameters:</span>
    <span class="hljs-attr">loadbalance:</span> <span class="hljs-string">random</span>
<span class="hljs-string">...</span>
</code></pre>
</li>
<li>
<p>服务降级：(通常用于临时屏蔽某个出错的非关键服务)</p>
<pre><code class="language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">configVersion:</span> <span class="hljs-string">v2.7</span>
<span class="hljs-attr">scope:</span> <span class="hljs-string">service</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">org.apache.dubbo.samples.governance.api.DemoService</span>
<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">configs:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">side:</span> <span class="hljs-string">consumer</span>
 <span class="hljs-attr">parameters:</span>
   <span class="hljs-attr">force:</span> <span class="hljs-string">return</span> <span class="hljs-literal">null</span>
<span class="hljs-string">...</span>
</code></pre>
</li>
</ol>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/dev/build.html" target="_self">开发者指南</a></dd><dd><a href="/zh-cn/docs/admin/ops/dubbo-ops.html" target="_self">运维管理</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">编辑此文档</a></dd></dl></div></div><div class="copyright"><span>TODO Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>