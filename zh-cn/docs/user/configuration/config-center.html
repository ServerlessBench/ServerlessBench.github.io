<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="config-center" />
	<meta name="description" content="config-center" />
	<!-- 网页标签标题 -->
	<title>config-center</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/index.html">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a target="_self" href="/zh-cn/docs/user/quick-start.html">文档</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/docs/developers/developers_dev.html">开发者</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/zh-cn/blog/download.html">下载</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>文档</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/preface/background.html" target="_self">背景</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>动态配置中心</h1>
<p>配置中心（v2.7.0）在Dubbo中承担两个职责：</p>
<ol>
<li>外部化配置。启动配置的集中式存储 （简单理解为dubbo.properties的外部化存储）。</li>
<li>服务治理。服务治理规则的存储与通知。</li>
</ol>
<p>启用动态配置（以Zookeeper为例，可查看<a href="../references/xml/dubbo-config-center.md">动态配置配置项详解</a>）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:config-center</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"zookeeper://127.0.0.1:2181"</span>/&gt;</span>
</code></pre>
<p>或者</p>
<pre><code class="language-properties"><span class="hljs-meta">dubbo.config-center.address</span>=<span class="hljs-string">zookeeper://127.0.0.1:2181</span>
</code></pre>
<p>或者</p>
<pre><code class="language-java">ConfigCenterConfig configCenter = <span class="hljs-keyword">new</span> ConfigCenterConfig();
configCenter.setAddress(<span class="hljs-string">"zookeeper://127.0.0.1:2181"</span>);
</code></pre>
<blockquote>
<p>为了兼容2.6.x版本配置，在使用Zookeeper作为注册中心，且没有显示配置配置中心的情况下，Dubbo框架会默认将此Zookeeper用作配置中心，但将只作服务治理用途。</p>
</blockquote>
<h2>外部化配置</h2>
<p>外部化配置目的之一是实现配置的集中式管理，这部分业界已经有很多成熟的专业配置系统如Apollo, Nacos等，Dubbo所做的主要是保证能配合这些系统正常工作。</p>
<p>外部化配置和其他本地配置在内容和格式上并无区别，可以简单理解为<code>dubbo.properties</code>的外部化存储，配置中心更适合将一些公共配置如注册中心、元数据中心配置等抽取以便做集中管理。</p>
<pre><code class="language-properties"><span class="hljs-comment"># 将注册中心地址、元数据中心地址等配置集中管理，可以做到统一环境、减少开发侧感知。</span>
<span class="hljs-meta">dubbo.registry.address</span>=<span class="hljs-string">zookeeper://127.0.0.1:2181</span>
<span class="hljs-meta">dubbo.registry.simplified</span>=<span class="hljs-string">true</span>

<span class="hljs-meta">dubbo.metadata-report.address</span>=<span class="hljs-string">zookeeper://127.0.0.1:2181</span>

<span class="hljs-meta">dubbo.protocol.name</span>=<span class="hljs-string">dubbo</span>
<span class="hljs-meta">dubbo.protocol.port</span>=<span class="hljs-string">20880</span>

<span class="hljs-meta">dubbo.application.qos.port</span>=<span class="hljs-string">33333</span>
</code></pre>
<ul>
<li>优先级</li>
</ul>
<p>外部化配置默认较本地配置有更高的优先级，因此这里配置的内容会覆盖本地配置值，关于<a href="./configuration-load-process.md">各配置形式间的覆盖关系</a>有单独一章说明，你也可通过以下选项调整配置中心的优先级：</p>
<pre><code class="language-properties"><span class="hljs-meta">-Ddubbo.config-center.highest-priority</span>=<span class="hljs-string">false</span>
</code></pre>
<ul>
<li>作用域</li>
</ul>
<p>外部化配置有全局和应用两个级别，全局配置是所有应用共享的，应用级配置是由每个应用自己维护且只对自身可见的。</p>
<p>当前已支持的扩展实现有Zookeeper、Apollo。</p>
<h4>Zookeeper</h4>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:config-center</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"zookeeper://127.0.0.1:2181"</span>/&gt;</span>
</code></pre>
<p>默认所有的配置都存储在<code>/dubbo/config</code>节点，具体节点结构图如下：</p>
<p><img src="/img/zk-configcenter.jpg" alt="image-20190127225608553"></p>
<ul>
<li>namespace，用于不同配置的环境隔离。</li>
<li>config，Dubbo约定的固定节点，不可更改，所有配置和服务治理规则都存储在此节点下。</li>
<li>dubbo/application，分别用来隔离全局配置、应用级别配置：dubbo是默认group值，application对应应用名</li>
<li>dubbo.properties，此节点的node value存储具体配置内容</li>
</ul>
<h4>Apollo</h4>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:config-center</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"apollo"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"127.0.0.1:2181"</span>/&gt;</span>
</code></pre>
<p>Apollo中的一个核心概念是命名空间 - namespace（和上面zookeeper的namespace概念不同），在这里全局和应用级别配置就是通过命名空间来区分的。</p>
<p>默认情况下，Dubbo会从名叫<code>dubbo</code>（由于 Apollo 不支持特殊后缀 <code>.properties</code> ）的命名空间中读取全局配置（<code>&lt;dubbo:config-center namespace=&quot;your namespace&quot;&gt;</code>）</p>
<p><img src="/img/apollo-configcenter-dubbo.png" alt="image-20190128095444169"></p>
<p>由于 Apollo 也默认将会在 <code>dubbo</code> namespace 中存储服务治理规则（如路由规则），建议通过单独配置 <code>group</code> 将服务治理和配置文件托管分离开，以 XML 配置方式为例：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"governance"</span> <span class="hljs-attr">group</span> =<span class="hljs-string">"dubbo"</span>/&gt;</span>
</code></pre>
<p>这里，服务治理规则将存储在 governance namespace，而配置文件将存储在 dubbo namespace，如下图所示：
<img src="/img/apollo-configcenter-governance-dubbo.png" alt="image-20190128095444169"></p>
<blockquote>
<p>关于文件配置托管，相当于是把 <code>dubbo.properties</code> 配置文件的内容存储在了 Apollo 中，应用通过关联共享的 <code>dubbo</code> namespace 继承公共配置,
应用也可以按照 Apollo 的做法来覆盖个别配置项。</p>
</blockquote>
<h4>自己加载外部化配置</h4>
<p>所谓Dubbo对配置中心的支持，本质上就是把<code>.properties</code>从远程拉取到本地，然后和本地的配置做一次融合。理论上只要Dubbo框架能拿到需要的配置就可以正常的启动，它并不关心这些配置是自己加载到的还是应用直接塞给它的，所以Dubbo还提供了以下API，让用户将自己组织好的配置塞给Dubbo框架（配置加载的过程是用户要完成的），这样Dubbo框架就不再直接和Apollo或Zookeeper做读取配置交互。</p>
<pre><code class="language-java"><span class="hljs-comment">// 应用自行加载配置</span>
Map&lt;String, String&gt; dubboConfigurations = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
dubboConfigurations.put(<span class="hljs-string">"dubbo.registry.address"</span>, <span class="hljs-string">"zookeeper://127.0.0.1:2181"</span>);
dubboConfigurations.put(<span class="hljs-string">"dubbo.registry.simplified"</span>, <span class="hljs-string">"true"</span>);

<span class="hljs-comment">//将组织好的配置塞给Dubbo框架</span>
ConfigCenterConfig configCenter = <span class="hljs-keyword">new</span> ConfigCenterConfig();
configCenter.setExternalConfig(dubboConfigurations);
</code></pre>
<h2>服务治理</h2>
<h4>Zookeeper</h4>
<p>默认节点结构：</p>
<p><img src="/img/zk-configcenter-governance.jpg" alt="image-20190128101129591"></p>
<ul>
<li>namespace，用于不同配置的环境隔离。</li>
<li>config，Dubbo约定的固定节点，不可更改，所有配置和服务治理规则都存储在此节点下。</li>
<li>dubbo，所有服务治理规则都是全局性的，dubbo为默认节点</li>
<li>configurators/tag-router/condition-router，不同的服务治理规则类型，node value存储具体规则内容</li>
</ul>
<h4>Apollo</h4>
<p>所有的服务治理规则都是全局性的，默认从公共命名空间<code>dubbo</code>读取和订阅：</p>
<p><img src="/img/apollo-configcenter-governance.jpg" alt="image-20190128100600055"></p>
<p>不同的规则以不同的key后缀区分：</p>
<ul>
<li>configurators，<a href="../demos/config-rule.md">覆盖规则</a></li>
<li>tag-router，<a href="../demos/routing-rule.md">标签路由</a></li>
<li>condition-router，<a href="../demos/routing-rule.md">条件路由</a></li>
</ul>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/user/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/dev/build.html" target="_self">开发者指南</a></dd><dd><a href="/zh-cn/docs/admin/ops/dubbo-ops.html" target="_self">运维管理</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">编辑此文档</a></dd></dl></div></div><div class="copyright"><span>TODO Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>