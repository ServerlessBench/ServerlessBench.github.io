<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="local-mock" />
	<meta name="description" content="local-mock" />
	<!-- 网页标签标题 -->
	<title>local-mock</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/index.html">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a target="_self" href="/en-us/docs/user/quick-start.html">DOCS</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/docs/developers/developers_dev.html">DEVELOPERS</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/blog/download.html">DOWNLOAD</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>Documentation</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Document</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/user/preface/background.html" target="_self">Background</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/user/quick-start.html" target="_self">Quick start</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>Local mock</h1>
<p>Local mock <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> is usually used for service downgrade, such as a verification service, the client does not throw an exception when the service provider hangs up all the time, but returns the authorization failed through the Mock data.</p>
<p>Configured in the spring configuration file as follows:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"true"</span> /&gt;</span>
</code></pre>
<p>or</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"com.foo.BarServiceMock"</span> /&gt;</span>
</code></pre>
<p>Mock implementation in the project <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>：</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> com.foo;
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BarServiceMock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BarService</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sayHello</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-comment">// You can return mock data, this method is only executed when an RpcException is thrown.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"mock data"</span>;
    }
}
</code></pre>
<p>If the service consumer often needs <code>try-catch</code> to catch exceptions, such as:</p>
<pre><code class="language-java">Offer offer = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">try</span> {
    offer = offerService.findOffer(offerId);
} <span class="hljs-keyword">catch</span> (RpcException e) {
   logger.error(e);
}
</code></pre>
<p>Consider changing to Mock implementation and return null in Mock implementation. If you just want to simply ignore the exception, <code>2.0.11</code> version or later version is available:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"return null"</span> /&gt;</span>
</code></pre>
<h2>Advanced Usage</h2>
<h3>return</h3>
<p><code>return</code> can be used to return an object's string representation as the mocked return value. The legal values incude:</p>
<ul>
<li><em>empty</em>: empty value, default value for primary type, and empty value for collections.</li>
<li><em>null</em>: <code>null</code></li>
<li><em>true</em>: <code>true</code></li>
<li><em>false</em>: <code>false</code></li>
<li><em>JSON format</em>: a mocked return value in JSON format, will be deserialized at runtime</li>
</ul>
<h3>throw</h3>
<p><code>throw</code> can be used to throw an exception object as the mocked return value.</p>
<p>Throw a default RPCException when invocation gets wrong:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"throw"</span> /&gt;</span>
</code></pre>
<p>Throw a specified exception when invocation gets wrong:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"throw com.foo.MockException"</span> /&gt;</span>
</code></pre>
<h3>force &amp; fail</h3>
<p>Since <code>2.6.6</code> and above, it is possible to use <code>fail:</code> and <code>force:</code> in Spring's XML configuration to define mock behavior. <code>force:</code> means the mocked value is forced to use no matter the invocation gets wrong or not, in fact, the remote invocation will not happen at all. <code>fail:</code> is consistent with the default behavior, that is, mock happens only when invocation gets wrong. Futhermore, both <code>force:</code> and <code>fail:</code> can be used together with <code>throw</code> or <code>return</code> to define the mock behavior further.</p>
<p>Force to return the specified value:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"force:return fake"</span> /&gt;</span>
</code></pre>
<p>Force to throw the specified exception:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"force:throw com.foo.MockException"</span> /&gt;</span>
</code></pre>
<h3>Specify Mock For Particular Method Only</h3>
<p>Mock behavior can be specified on the method level. Assume there are a couple of methods on <code>com.foo.BarService</code>, we can specify the mock behavior for one particular method only, say <code>sayHello()</code>. In the example below, &quot;fake&quot; is forced to return everytime when <code>sayHello()</code> is called, but other methods will not be effected:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"demoService"</span> <span class="hljs-attr">check</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:parameter</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"sayHello.mock"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"force:return fake"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span>
</code></pre>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Mock is a subset of the Stub. If you use Stub, you may need to rely on the RpcException class. If you use Mock, you do not need to rely on RpcException, when throwing RpcException, it will callback Mock implementation class. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>BarServiceMock implements BarService and has a no-argument constructor. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>Documentation</dt><dd><a href="/en-us/docs/user/quick-start.html" target="_self">Quick start</a></dd><dd><a href="/en-us/docs/dev/build.html" target="_self">Developer guide</a></dd><dd><a href="/en-us/docs/admin/ops/dubbo-ops.html" target="_self">Admin manual</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">Report a Doc Issue</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">Edit This Page on GitHub</a></dd></dl></div></div><div class="copyright"><span>TODO Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>