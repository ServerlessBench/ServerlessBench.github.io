<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="zookeeper" />
	<meta name="description" content="zookeeper" />
	<!-- 网页标签标题 -->
	<title>zookeeper</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/index.html">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a target="_self" href="/en-us/docs/user/quick-start.html">DOCS</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/docs/developers/developers_dev.html">DEVELOPERS</a></li><li class="menu-item menu-item-normal"><a target="_self" href="/en-us/blog/download.html">DOWNLOAD</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>Documentation</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Document</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/user/preface/background.html" target="_self">Background</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/user/quick-start.html" target="_self">Quick start</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>Zookeeper Registry Server</h1>
<p><a href="http://zookeeper.apache.org">Zookeeper</a> is the child project of apache hadoop. Since it offers tree-like directory service and supports change notification, it's suitable to use it as dubbo's registry server. It's a field-proven product, therefore it's recommended to use it in the production environment. <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<p><img src="../../sources/images/zookeeper.jpg" alt="/user-guide/images/zookeeper.jpg"></p>
<p>Description on registration procedure:</p>
<ul>
<li>When service provider boots up: write service URL address under directory <code>/dubbo/com.foo.BarService/providers</code></li>
<li>When service consumer boots up: subscribe to <code>/dubbo/com.foo.BarService/providers</code> for provider's URL addresses. At the same time, write consumer's URL address under <code>/dubbo/com.foo.BarService/consumers</code>.</li>
<li>When monitor center boots up: subscribe to <code>/dubbo/com.foo.BarService</code> for the URL addresses from all providers and consumers.</li>
</ul>
<p>The following abilities are supported:</p>
<ul>
<li>When provider stops by accident, registry server can remove its info automatically.</li>
<li>When registry server reboots, all registration data and subscription requests can be recovered automatically.</li>
<li>When session is expired, all registration data and subscription requests can be recovered automatically.</li>
<li>When <code>&lt;dubbo:registry check=&quot;false&quot; /&gt;</code> is configured, failed requests for subscription and registration will be recorded and kept retrying in the background.</li>
<li>Configure <code>&lt;dubbo:registry username=&quot;admin&quot; password=&quot;1234&quot; /&gt;</code> for zookeeper login.</li>
<li>Configure <code>&lt;dubbo:registry group=&quot;dubbo&quot; /&gt;</code> for dubbo's root node on zookeeper. Default root node will be used if it's not specified.</li>
<li>Support to use wildcard <code>*</code> in <code>&lt;dubbo:reference group=&quot;*&quot; version=&quot;*&quot; /&gt;</code> in order to subscribe all groups and all versions for the services to be referenced.</li>
</ul>
<h2>How to Use</h2>
<p>Add zookeeper client dependency in both provider and consumer:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Or <a href="http://repo1.maven.org/maven2/org/apache/zookeeper/zookeeper">download</a> directly from apache.</p>
<p>Dubbo supports two zookeeper clients: zkclient and curator:</p>
<h3>Use zkclient</h3>
<p>Since <code>2.2.0</code> dubbo uses zkclient by default, in order to improve the robustness. <a href="https://github.com/sgroschupf/zkclient">zkclient</a> is a zookeeper client implementation open-sourced by Datameer.</p>
<p><strong>Note: The implementation of zkclient has been removed in the 2.7.x version. If you want to use the zkclient client, you need to extend it yourself.</strong></p>
<p>Default configuration:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">...</span> <span class="hljs-attr">client</span>=<span class="hljs-string">"zkclient"</span> /&gt;</span>
</code></pre>
<p>Or:</p>
<pre><code class="language-sh">dubbo.registry.client=zkclient
</code></pre>
<p>Or:</p>
<pre><code class="language-sh">zookeeper://10.20.153.10:2181?client=zkclient
</code></pre>
<p>In order to use it, need to explicitly declare the following maven dependency or <a href="http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient">download its client</a>.</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.sgroschupf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zkclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3>Use curator</h3>
<p>Since <code>2.3.0</code> dubbo also supports curator but explicit configuration is required. <a href="https://github.com/Netflix/curator">Curator</a> is the zookeeper client open-sourced by Netflix.</p>
<p>In order to switch to curator, use the configuration below:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">...</span> <span class="hljs-attr">client</span>=<span class="hljs-string">"curator"</span> /&gt;</span>
</code></pre>
<p>Or:</p>
<pre><code class="language-sh">dubbo.registry.client=curator
</code></pre>
<p>Or:</p>
<pre><code class="language-sh">zookeeper://10.20.153.10:2181?client=curator
</code></pre>
<p>Also need to explicitly add maven dependency or directly <a href="http://repo1.maven.org/maven2/com/netflix/curator/curator-framework">download</a> the jar:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.netflix.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Zookeeper single node configuration:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"zookeeper://10.20.153.10:2181"</span> /&gt;</span>
</code></pre>
<p>Or:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"zookeeper"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"10.20.153.10:2181"</span> /&gt;</span>
</code></pre>
<p>Zookeeper cluster configuration：</p>
<pre><code class="language-xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"zookeeper://10.20.153.10:2181?backup=10.20.153.11:2181,10.20.153.12:2181"</span> /&gt;</span>
</code></pre>
<p>Or:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"zookeeper"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181"</span> /&gt;</span>
</code></pre>
<p>Configure single zookeeper to serve as multiple registry servers:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chinaRegistry"</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"zookeeper"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"10.20.153.10:2181"</span> <span class="hljs-attr">group</span>=<span class="hljs-string">"china"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"intlRegistry"</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"zookeeper"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"10.20.153.10:2181"</span> <span class="hljs-attr">group</span>=<span class="hljs-string">"intl"</span> /&gt;</span>
</code></pre>
<h2>Zookeeper Installation</h2>
<p>Pls. refer to <a href="../../../admin/install/zookeeper.md">zookeeper install manual</a> for how to install zookeeper based registry server. To set it up, specify <code>dubbo.registry.address</code> to <code>zookeeper://127.0.0.1:2181</code> in <code>conf/dubbo.properties</code> for both provider and consumer (you can refer to <a href="../../quick-start.md">quick start</a>) after install a zookeeper server.</p>
<h2>Declaration of Reliability</h2>
<p>A home-brewed service registry server is used in Alibaba instead of zookeeper server. Zookeeper based registry center does not have long-run practice within Alibaba, therefore we cannot guarantee its reliability. Zookeeper registry server is provided for dubbo community, and its reliability relies on zookeeper itself largely.</p>
<h2>Declaration of Compatibility</h2>
<p>The original designed data structure for zookeeper in <code>2.0.8</code> has the limitation that data type cannot extended, it's redesigned in <code>2.0.9</code>. But at the same time incompatibility is introduced, thereby <code>2.0.9</code> is required for all service providers and service consumers.</p>
<p>Since <code>2.2.0</code> zkclient is used by default, therefore its dependency is needed.</p>
<p>Since <code>2.3.0</code> curator is supported as alternative option.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Suggest to use <code>2.3.3</code> or above for zookeeper registry client <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>Documentation</dt><dd><a href="/en-us/docs/user/quick-start.html" target="_self">Quick start</a></dd><dd><a href="/en-us/docs/dev/build.html" target="_self">Developer guide</a></dd><dd><a href="/en-us/docs/admin/ops/dubbo-ops.html" target="_self">Admin manual</a></dd><dd><a href="https://github.com/apache/dubbo-website/issues/new" target="_self">Report a Doc Issue</a></dd><dd><a href="https://github.com/apache/dubbo-website" target="_self">Edit This Page on GitHub</a></dd></dl></div></div><div class="copyright"><span>TODO Copyright © 2018-2019 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>